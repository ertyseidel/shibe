<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>such translate</title>
	<link rel="stylesheet" href="shibe.css">
	<script src="./lexer/lexer.js"></script>
	<script src="./lexer/lexicon.js_"></script>
	<script src="./lexer/POSTagger.js"></script>
	<script type="text/javascript">
		var lexer = new Lexer();
		var posTagger = new POSTagger();
		var lexWords = function(){
			var inEl = document.getElementById('input');
			var words = lexer.lex(inEl.value);
			return posTagger.tag(words);
		};
		var objToSortedArray = function(obj){
			//this next part can be optimized
			//right now it is like O(n^2)
			var arr = Array();
			while(Object.keys(obj).length > 0){
				var max = 0;
				var maxVal = null;
				for(var i in obj){
					if(obj[i] > max){
						maxVal = i;
						max = obj[i];
					}
				}
				arr.push(maxVal);
				delete obj[maxVal];
			}
			return arr;
		};
		var sortWords = function(taggedWords){
			var tags = ['CC', 'CD', 'DT', 'EX', 'FW', 'IN', 'JJ', 'JJR', 'JJS', 'LS', 'MD', 'NN', 'NNP', 'NNPS', 'NNS', 'POS', 'PDT', 'PP$', 'PRP', 'PRP$', 'RB', 'RBR', 'RBS', 'RP', 'SYM', 'TO', 'UH', 'VB', 'VBD', 'VBG', 'VBN', 'VBP', 'VBZ', 'WDT', 'WP', 'WP$', 'WRB'];
			wordList = {};
			for(var t in tags){
				wordList[tags[t]] = {};
			}
			for (var i in taggedWords) {
				var taggedWord = taggedWords[i];
				var word = taggedWord[0].toLowerCase();
				var tag = taggedWord[1];
				word.replace(/[^A-Za-z]/g, '');
				if(word.length > 2 && word.indexOf("'") === -1){
					if(wordList[tag][word]){
						wordList[tag][word] += 1;
					} else{
						wordList[tag][word] = 1;
					}
				}
			}
			return wordList;
		};
		var getPhrases = function(){
			var phrases = document.getElementById('phrases').value.split("\n");
			var i = phrases.length;
			for(var k = 0; k < i; k++){
				while(phrases[k][0] === '*'){
					phrases.push(phrases[k].replace(/\*/g, ''));
					phrases[k] = phrases[k].substring(1);
				}
			}
			phrases = phrases.map(function(a){return a.trim().toLowerCase()});
			phrases = phrases.filter(function(a){return a.length > 2});
			console.log(phrases);
			return phrases;
		};
		var getRandomPhrase = function(words, phrases){
			var chosenPhrase = phrases[parseInt(Math.random() * phrases.length)];
			chosenPhrase = chosenPhrase.replace(/\[(.*)\]/g, function(match){
				match = match.replace(/[\[\]]/g, '').toUpperCase();
				if(words[match]){
					var tagwords = Object.keys(words[match]);
					return tagwords[parseInt(Math.random() * tagwords.length)];
				} else{
					return match;
				}
			});
			return chosenPhrase;
		};
		var createShibe = function(words, phrases){
			var outEl = document.getElementById('output');

			outEl.value = "";

			wow = parseFloat(document.getElementById('wow').value);
			phraseDensity = parseFloat(document.getElementById('phrasedensity').value);
			blankChance = parseFloat(document.getElementById('blankchance').value);

			for(var line = 0; line < outEl.rows; line++){
				if(Math.random() < blankChance){
					//blank line
					outEl.value += "    \n";
				} else{
					var len = 4;
					outEl.value += "    ";
					while(len < outEl.cols){
						var rand = Math.random();
						var toWrite = "";
						if(rand < phraseDensity){
							toWrite = getRandomPhrase(words, phrases);
						} else if(rand < wow + phraseDensity){
							toWrite = "wow"
						}
						if(len + toWrite.length < outEl.cols){
							outEl.value += toWrite;
							len += toWrite.length;
						}
						var spaces = parseInt(Math.random() * 10) + 5;
						for(var f = 0; f < spaces; f++){
							outEl.value += " "
						}
						len += spaces;
					}
					outEl.value += "\n";
				}
			}
		};
	</script>
</head>
<body>
	<div id="shibe">
		<div>
			<h2>Shibe Generator</h2>
			<p>"Translates" a text into shibe. Paste a large text into the "input" box, hit "generate", and enjoy your own personal shibe. Works better with larger texts (Shakespeare, anyone?).</p>
		</div>
		<div>
			<p>Thanks very much to the LGPL'd <a href="https://code.google.com/p/jspos/">jspos library</a>, itself a js port of <a href="http://www.markwatson.com/opensource/">Mark Watson's FastTag</a>, which handles all of the heavy lifting of this program.</p>
		</div>
		<div>
			<p>Input text (paste something good here):</p><textarea id="input" cols="80" rows="10"></textarea>
		</div>
		<div>
			<p>Settings:</p>
			<p><label for="wow">"wow" density: </label><input id="wow" type="number" value="0.05" min="0" max="1" step="0.05"/></p>
			<p><label for="phrasedensity">phrase density: </label><input id="phrasedensity" type="number" value="0.2" min="0" max="1" step="0.05"</></p>
			<p><label for="blankchance">blank line chance: </label><input id="blankchance" type="number" value="0.75" min="0" max="1" step="0.05"/></p>
		</div>
		<div>
			<p>Phrases to use</p>
			<ul>
				<li>One Per Line</li>
				<li>Parts of speech in brackets
					<ul>
						<li>i.e. [NN] = noun, [JJ] = adjective</li>
						<li><a style="color:blue;text-decoration:underline;cursor:pointer" onclick="var t=document.getElementById('taglist');if(t.style.display=='block'){t.style.display='none';}else{t.style.display='block';}">Show/Hide parts-of-speech List</a></li>
					</ul>
				</li>
				<li>The more *s before a line, the more likely that phrase is to show up.</li>
				<li>"wow"s are added automatically, controlled by the "wow density" input above.</li>
			</ul>
			</p><textarea id="phrases" cols="30" rows="10"></textarea>
		</div>
		<script type="text/javascript">
			document.getElementById("phrases").value += "**such [NN]\n";
			document.getElementById("phrases").value += "*so much [NN]\n";
			document.getElementById("phrases").value += "*very [JJ]\n";
			document.getElementById("phrases").value += "*so [JJ]\n";
			document.getElementById("phrases").value += "*much [JJ]\n";
			document.getElementById("phrases").value += "r u troleing me?\n";
			document.getElementById("phrases").value += "good doge\n";
			document.getElementById("phrases").value += "dogge\n";
		</script>
		<div id="taglist" style="display:none">
			<pre>
	CC Coord Conjuncn           and,but,or
	CD Cardinal number          one,two
	DT Determiner               the,some
	EX Existential there        there
	FW Foreign Word             mon dieu
	IN Preposition              of,in,by
	JJ Adjective                big
	JJR Adj., comparative       bigger
	JJS Adj., superlative       biggest
	LS List item marker         1,One
	MD Modal                    can,should
	NN Noun, sing. or mass      dog
	NNP Proper noun, sing.      Edinburgh
	NNPS Proper noun, plural    Smiths
	NNS Noun, plural            dogs
	POS Possessive ending       's
	PDT Predeterminer           all, both
	PP$ Possessive pronoun      my,one's
	PRP Personal pronoun        I,you,she
	PRP$ Pers. Pos. pronoun     My,His,Hers
	RB Adverb                   quickly
	RBR Adverb, comparative     faster
	RBS Adverb, superlative     fastest
	RP Particle                 up,off
	SYM Symbol                  +,%,&amp;
	TO 'to'                     to
	UH Interjection             oh, oops
	VB verb, base form          eat
	VBD verb, past tense        ate
	VBG verb, gerund            eating
	VBN verb, past part         eaten
	VBP Verb, present           eat
	VBZ Verb, present           eats
	WDT Wh-determiner           which,that
	WP Wh pronoun               who,what
	WP$ Possessive-Wh           whose
	WRB Wh-adverb               how,where
	</pre>
		</div>
		<div>
			<input class="button" type="button" onclick="createShibe(sortWords(lexWords()), getPhrases());" value="Generate"></button>
		</div>
		<div>
			<p>Output:</p>
			<p>If your output contains a lot of "undefined", you probably don't have any of that part of speech in your input text.</p>
			<p>Hit "generate" until you get a shibe text you like!</p>
			<textarea id="output" rows="20" cols="80"></textarea></div>
		<div>
			<p>Created by <a href="./erty.me">Erty Seidel</a>.</p>
		</div>
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-783271-7', 'erty.me');
			ga('send', 'pageview');

		</script>
	</div>
</body>
</html>

