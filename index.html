<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>such translate</title>
	<script src="./lexer/lexer.js"></script>
	<script src="./lexer/lexicon.js_"></script>
	<script src="./lexer/POSTagger.js"></script>
	<script type="text/javascript">
		var lexer = new Lexer();
		var posTagger = new POSTagger();
		var lexWords = function(inID){
			var inEl = document.getElementById(inID);
			var words = lexer.lex(inEl.value);
			return posTagger.tag(words);
		};
		var objToSortedArray = function(obj){
			//this next part can be optimized
			//right now it is like O(n^2)
			var arr = Array();
			while(Object.keys(obj).length > 0){
				var max = 0;
				var maxVal = null;
				for(var i in obj){
					if(obj[i] > max){
						maxVal = i;
						max = obj[i];
					}
				}
				arr.push(maxVal);
				delete obj[maxVal];
			}
			return arr;
		};
		var sortWords = function(taggedWords){
			adjList = {};
			nounList = {};
			for (i in taggedWords) {
				var taggedWord = taggedWords[i];
				var word = taggedWord[0].toLowerCase();
				var tag = taggedWord[1];
				word.replace(/[^A-Za-z]/g, '');
				if(word.length > 2 && word.indexOf("'") === -1){
					if(tag == "JJ"){
						if(adjList[word]){
							adjList[word] += 1;
						} else{
							adjList[word] = 1;
						}
					} else if (tag == "NN" || tag == "NNP" || tag == "NNPS" || tag == "NNS"){
						if(nounList[word]){
							nounList[word] += 1;
						} else{
							nounList[word] = 1;
						}
					}
				}
			}
			return {
				adj: objToSortedArray(adjList),
				noun: objToSortedArray(nounList)
			};
		};
		var getPhrases = function(phraseID){
			var phrases = document.getElementById(phraseID).value.split("\n");
			return phrases.map(function(a){return a.trim().toLowerCase()});
		};
		var createShibe = function(words, phrases, outID){
			var outEl = document.getElementById(outID);
			if(words.adj.length < 5 || words.noun.length < 5){
				outEl.value = "You need more text for the shibe translator to work correctly.\n\n\n\n       wow\n\n     such emptiness";
				return;
			}

			outEl.value = "";

			var fronts = {
				adj: ['very', 'such', 'much'],
				noun: ['so', 'so', 'so much']
			};

			var blank = (Math.random() * .5) + .3;

			var adj = .05;
			var noun = adj + .05;
			var wow = noun + .03;
			var phrase = wow + .01;

			var adjIndex = 0;
			var phraseIndex = 0;
			var nounIndex = 0;

			for(var line = 0; line < outEl.rows; line++){
				if(Math.random() < blank){
					//blank line
					outEl.value += "    \n";
				} else{
					var len = 4;
					outEl.value += "    ";
					while(len < outEl.cols){
						var rand = Math.random();
						var toWrite = "";
						if(rand < adj){
							toWrite = fronts.adj[Math.floor(Math.random()*fronts.adj.length)] + " " + words.adj[adjIndex % words.adj.length];
							adjIndex ++;
						} else if(rand < noun){
							toWrite = fronts.noun[Math.floor(Math.random()*fronts.noun.length)] + " " + words.noun[nounIndex % words.noun.length];
							nounIndex ++;
						} else if(rand < wow){
							toWrite = "wow";
						} else if(rand < phrase && phrases.length > 0){
							toWrite = phrases[phraseIndex % phrases.length];
							phraseIndex ++;
						}
						if(len + toWrite.length < outEl.cols){
							outEl.value += toWrite;
							len += toWrite.length;
						}
						outEl.value += "     "
						len += 5;
					}
					outEl.value += "\n";
				}
			}
		};
	</script>
</head>
<body>
	<div>
	<h2>Currently under construction. Some things might not work right.</h2>
	</div>
	<div>
	<p>Thanks very much to the LGPL'd <a href="https://code.google.com/p/jspos/">jspos library</a>, itself a js port of <a href="http://www.markwatson.com/opensource/">Mark Watson's FastTag</a>, which handles all of the heavy lifting of this program.</p>
	</div>
	<div><p>Input text:</p><textarea id="input" cols="80" rows="10"></textarea></div>
	<div><p>Phrases to use (one per line):</p><textarea id="phrases" cols="30" rows="10"></textarea></div>
	<script type="text/javascript">
		document.getElementById("phrases").value = "such trole\ngood doge\ndogge\ntrole\nr u troleing me?"
	</script>
	<div><input type="button" onclick="createShibe(sortWords(lexWords('input')), getPhrases('phrases'), 'output');" value="Generate"></button></div>
	<div><p>Output:</p><textarea id="output" rows="20" cols="80"></textarea></div>
	<div>Created by <a href="./erty.me">Erty Seidel</a>.</div>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-783271-7', 'erty.me');
		ga('send', 'pageview');

	</script>
</body>
</html>

